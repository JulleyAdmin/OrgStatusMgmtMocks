# Firebase Authentication Setup for SPOC Users

## Prerequisites

### 1. Install Firebase Admin SDK

```bash
cd apps/pms
npm install firebase-admin
```

### 2. Set Environment Variables

Add the following to your `.env.local` file in `apps/pms/`:

```env
FIREBASE_CLIENT_EMAIL=your-firebase-admin@your-project.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYour_Private_Key_Here\n-----END PRIVATE KEY-----\n"
```

**To get these values:**

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project: `julley-platform-dev`
3. Go to **Project Settings** (gear icon) → **Service Accounts**
4. Click **"Generate New Private Key"**
5. Open the downloaded JSON file
6. Copy `client_email` → `FIREBASE_CLIENT_EMAIL`
7. Copy `private_key` → `FIREBASE_PRIVATE_KEY` (keep it as a single line with `\n` for newlines)

**⚠️ Security:**
- Never commit `.env.local` to git (already in .gitignore)
- Keep your private key secure
- Rotate keys regularly

## Running the Seed Script

```bash
# Make sure .env.local has FIREBASE_CLIENT_EMAIL and FIREBASE_PRIVATE_KEY
cd apps/pms
npm run seed:spocs
```

The script will automatically load environment variables from `.env.local`.

## What the Script Does

1. **Creates Firebase Auth Users**
   - Email: From the SPOC list
   - Password: Default password (should be changed on first login)
   - Phone: India format (+91)
   - Email verification: Required

2. **Creates Firestore User Documents**
   - Collection: `users/{uid}`
   - Includes: name, email, phone, role, departments, teams
   - Status: active

3. **Adds to Company Users**
   - Collection: `companies/{companyId}/companyUsers/{uid}`
   - Role: admin (SPOCs are admins)
   - Permissions: Full department and team management

4. **Generates Password Reset Links**
   - Displayed in console
   - Share with users so they can set their own passwords

## SPOC Users Being Created

| Name | Email | Phone | Departments |
|------|-------|-------|-------------|
| Praneeth | praneeth@autocracymachinery.com | 9010617403 | Management, Sales, Marketing, Investors |
| Divya | divya@autocracymachinery.com | 6309534939 | HR, Logistics, Service, PMT, PDT, PMG, After Sales |
| Swathi | swathi@autocracymachinery.com | 9502604695 | Finance, Accounts, Legal, Operations, LAXSUS |
| RajGopal | raj@autocracymachinery.com | 8919286433 | QC, Inventory, Procurement, Production, Machining |

## Default Credentials

- **Default Password**: `AutocracyMachinery@2024`
- **⚠️ Users MUST change password on first login**

## Security Best Practices

1. ✅ **Force password change** on first login (enabled in script)
2. ✅ **Send password reset links** to users (generated by script)
3. ✅ **Email verification** required
4. ✅ **Strong default password** (16+ characters)
5. ⚠️ **Never share passwords** over insecure channels
6. ⚠️ **Use password reset links** instead of default password

## Troubleshooting

### Error: "GOOGLE_APPLICATION_CREDENTIALS not set"

**Solution**: Set the environment variable or place `serviceAccountKey.json` in project root

### Error: "Permission denied"

**Solution**: Make sure your Firebase project has Authentication enabled and you have admin access

### Error: "Email already exists"

**Solution**: The script will detect existing users and skip creation. It will use the existing UID to update Firestore records.

### Error: "Invalid phone number"

**Solution**: Phone numbers must be in E.164 format (+91XXXXXXXXXX). The script handles this automatically.

## Next Steps

1. Run the seed script
2. Copy the password reset links from console output
3. Share links with respective users via secure channel (email/SMS)
4. Users click link and set their own password
5. Users can now login to the PMS system

## Firestore Collections Structure

```
users/
  {uid}/
    - id: string
    - companyId: string
    - email: string
    - name: string
    - phone: string
    - role: 'spoc'
    - spocDepartments: string[]
    - spocTeams: string[]
    - permissions: {...}

companies/
  {companyId}/
    companyUsers/
      {uid}/
        - userId: string
        - role: 'admin'
        - spocDepartments: string[]
        - spocTeams: string[]
        - permissions: {...}
```

## Alternative: Manual User Creation

If you prefer not to use the script, you can:

1. Go to Firebase Console → Authentication
2. Add users manually with email/password
3. Then run a simplified script to just create Firestore documents

## Support

For issues or questions, contact the development team.

